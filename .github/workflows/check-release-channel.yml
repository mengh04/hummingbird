name: Ensure RELEASE_CHANNEL is set to `stable` for releases

on:
  workflow_dispatch:
  pull_request_target:
    branches:
      - "release"
  push:
    branches:
      - "release"

jobs:
  validate-release-channel:
    runs-on: ubuntu-slim

    steps:
      - name: Checkout repo at tag
        uses: actions/checkout@v4

      - name: Validate RELEASE_CHANNEL
        run: |
          if [ ! -f package/RELEASE_CHANNEL ]; then
            echo "RELEASE_CHANNEL file missing"
            exit 1
          fi

          CHANNEL=$(cat package/RELEASE_CHANNEL | tr -d '\n')

          if [ "$CHANNEL" != "stable" ]; then
            echo "RELEASE_CHANNEL must be 'stable' for tagged releases, got: '$CHANNEL'"
            exit 1
          fi

          echo "RELEASE_CHANNEL is valid: '$CHANNEL'"
